@model SchoolBookPlatform.ViewModels.Setting.SettingChangePasswordViewModel

@{
    ViewData["Title"] = "Đổi mật khẩu";
}
@if (TempData["error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
<div class="container">
    <h2>Đổi mật khẩu</h2>
    <p>Vui lòng nhập mật khẩu mới để tiếp tục.</p>
    <form asp-action="SettingChangePassword" method="post">                      
        @Html.AntiForgeryToken()
        <div asp-validation-summary="All" class="text-danger"></div>
        <div class="form-group">
            <label asp-for="RecentPassword">Mật khẩu hiện tại</label>
            <input asp-for="RecentPassword" class="form-control"/>
            <span asp-validation-for="RecentPassword" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="NewPassword">Mật khẩu mới</label>
            <input asp-for="NewPassword" class="form-control"/>
            <span asp-validation-for="NewPassword" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ConfirmNewPassword">Xác nhận mật khẩu</label>
            <input asp-for="ConfirmNewPassword" class="form-control"/>
            <span asp-validation-for="ConfirmNewPassword" class="text-danger"></span>
        </div>
        <div class="form-group mb-4">
            <div class="form-check">
                <input asp-for="LogoutOtherDevices" class="form-check-input" />
                <label asp-for="LogoutOtherDevices" class="form-check-label">
                    <strong>Đăng xuất khỏi tất cả thiết bị khác</strong>
                </label>
            </div>
            <small class="form-text text-muted">
                Khi chọn tùy chọn này, tất cả các thiết bị khác đang đăng nhập bằng tài khoản của bạn sẽ bị đăng xuất.
            </small>
        </div>
        <button type="submit" class="btn btn-primary">Cập nhật</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Hủy bỏ</a>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial"/>
    <script>
        document.querySelector('form').addEventListener('submit', function(e) {
            const logoutCheckbox = document.getElementById('@Html.IdFor(m => m.LogoutOtherDevices)');
            
            if (logoutCheckbox && logoutCheckbox.checked) {
                const confirmed = confirm('Bạn có chắc muốn đăng xuất khỏi tất cả thiết bị khác?\\n\\nSau khi đổi mật khẩu, tất cả các phiên đăng nhập trên thiết bị khác sẽ bị hủy.');
                
                if (!confirmed) {
                    e.preventDefault();
                    logoutCheckbox.checked = false;
                }
            }
        });
    </script>
}